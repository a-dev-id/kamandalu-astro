---
import Layout from '../../../layouts/Base.astro';
import client from '../../../lib/sanityClient';
import { getLocale } from '../../../utils/getLocale.js';

// Static paths: generate /en/villas/slug, /ko/villas/slug, /zh/villas/slug
export async function getStaticPaths() {
  const supportedLangs = ['en', 'ko', 'zh'];

  const villas = await client.fetch(`*[_type == "villa"]{ "slug": slug.current }`);

  return supportedLangs.flatMap(lang => {
    return villas.map(villa => ({
      params: {
        lang,
        slug: villa.slug
      }
    }));
  });
}

// Get route parameters
const { lang, slug } = Astro.params;
const locale = getLocale(lang);

// Fetch villa by slug
const villa = await client.fetch(`*[_type == "villa" && slug.current == $slug][0]{
  title,
  description,
  mainImage {
    asset->{ url }
  }
}`, { slug });
---

<Layout title={villa.title?.[locale]} description={villa.description?.[locale]}>
  <section class="container mx-auto px-4 py-24">
    <div class="text-center mb-10">
      <h1 class="text-4xl font-bold uppercase">{villa.title?.[locale] ?? villa.title?.en}</h1>
    </div>

    {villa.mainImage?.asset?.url && (
      <div class="mb-10">
        <img src={villa.mainImage.asset.url} alt={villa.title?.[locale] ?? 'Villa'} class="w-full h-auto rounded-lg shadow" />
      </div>
    )}

    <div class="max-w-3xl mx-auto text-lg leading-relaxed">
      <p>{villa.description?.[locale] ?? villa.description?.en}</p>
    </div>
  </section>
</Layout>
